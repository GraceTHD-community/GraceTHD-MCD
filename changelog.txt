GraceTHD-MCD

### Changelog

v2_alpha3f
- correction sur le projet qgis de la version alpha3e qui pointait sur la version alpha3d de la base. 
- correction schéma simplifié (polygone sur Empreinte). 
- ajout d'un readme.txt dans db_spatialite pour expliquer le contenu de ce dossier. 
- diffusion d'un create.bat dans sql_spatialite
- ajout des scripts de création des tables adapté à la syntaxe PostGIS : sql_postgis. 
- Création d'un script sql spécifique pour la génération des index. 
- Changement d'ordre des tables pour respecter la cohérence de création des foreign keys (PostGIS). 
	- t_adresse
	- t_suf
	- t_ptech
	- t_ebp
	- t_cassette
	- t_position
	- t_ropt
- Correction noms d'attributs : 
	- ps_cs_code
	- fo_cb_code
	- ba_rf_code
	- ps_amont -> ps_1
	- ps_aval -> ps_2
- Correction type d'attributs : 
	- od_codeobj
	- ad_ietat
	- sf_ad_code
	- ps_cs_code
	- ba_rf_code
	- rt_fo_code
	- se_ad_code
- Correction Foreign keys : 
	- Plusieurs t_adrese au lieu de t_adresse. 
	- Plusieurs t_zone au lieu des tables par type de zone. 
	- dm_cd_code
	- dm_cm_code
	- fo_cb_code
	- ba_rf_code
	- ti_etat
	- zs_etatpm
	- zs_typeemp
	- zp_zs_code
- Correction NOT NULL
	- zn_code
	- zs_code
	- zp_code
	- zd_code
	- zc_code
- l_position_type : modification des codes et libellés. 
- l_statut : modification des définitions pour tenir dans moins de 254 caractères. 
- Indexes
	- Ajouts
- Correction index spatiaux PostGIS
	
v2_alpha3e
- Ajout d'un dossier MCD_doc : 
	- Ajout d'une présentation simplifiée du MCD : gracethd-mcd-v2alpha03e_doc_v01.ods
	- Passage du schéma simplifié dans ce dossier : gracethd-mcd-v2alpha03e_schema_v01.png
- mcd_alpha3e.ods
	- Ajout d'une légende 
	- Suppression de la feuille SQLite
	- Renommage de feuilles -> Attributs et Valeurs. 
- cb_bp_amon et cb_bp_aval : 
	- renommage en cb_bpcode1 et cb_bpcode2
	- définitions
	- foreign keys cb_bp* sur bp_code
- cm_noeud_a et cm_noeud_b : 
	- renommage en cm_ndcode1 et cm_ndcode2
	- définitions
	- foreign keys sur nd_code
	- suppression du NOT NULL pour permettre la saisie d'une BPE (noeud) à l'extrêmité d'un câble et non de devoir la créer au préalable. 
- cm_cm1 et cm_cm2 : 
	- renommages
	- définitions
	- foreign keys sur nd_code
- nd_ad_code : 
	- modif type

v2_alpha3d
- général : 
	- Pour PostGIS 
		- Réorganisation de l'ordre des tables pour passer la création sous PostGIS. 
		- Suppression des IF NOT EXISTS. 
		- Ajout des indexes spatiaux PostGIS. 
		- Passage des geom en fin de table pour correspondance de l'ordre entre Spatialite et PostGIS. 
	- Remplacement des ' et '' par des espaces dans les libellés et définitions des listes.
	- Extension des valeurs l_statut et suppression des attributs avancement. 
	- Ajout de TypePropriete sur les tables des équipements pouvant être construits, rachetés, loués, etc. 
	- Généralisation des notions de "Type Physique" et "Type Logique". 
	- Uniformation des noms et de l'ordre des attributs communs aux tables d'équipements. Notamment : 
		- xx_prop
		- xx_gest
		- xx_user
		- xx_typeprop
		- xx_statut
		- xx_etat
		- xx_dateins
		- xx_datems
	- xx_creadat et xx_majdate passés en type TIMESTAMP. 
	- ajout des indexes sur tous les attributs potentiellement bénéficiaires.
	- Modification des définitions de classes : 
		- SiteUtilisateurFinal
		- Adresse
	- Application générale d'un attribut commentaire. 
	- Uniformisation des foreign keys sur des attributs "code" et plus d'ID. 
- t_conduite 
	- renommage de la table t_fourreau
	- Occupation : passage en numérique, suppression de la relation et définition indiquant qu'il s'agit d'un pourcentage. 
	- abandon numero de serie
	- fx_ar_code : abandonné
- t_cable : 
	- cb_util -> cb_user
	- modification nom cb_rf_id
	- cb_ar_code : abandon
	- cb_fx_code : abandon
- t_cable_conduite : 
	- Création de la table de relation. 
- t_cheminement : 
	- Création de la table (fusion tranchée et artère)
- t_fibre : 
	- remplacement de la fk par l_etat_type. 
	- ajout : fo_type
- t_noeud : 
	- Passage sur les tables de spécialisation : 
		- nd_statut (passé sur tables de spécialisation. Une chambre et une bpe peuvent ne pas avoir le même statut). 
		- nd_etat (passé sur tables de spécialisation. Une chambre et une bpe peuvent ne pas avoir le même état). 
		- nd_haut
		- nd_pro
		- nd_gest
		- nd_user
		- nd_dateins
	- abandon nd_c_insee
- t_ptech : 
	- passage de : 
		- nd_haut à pt_a_haut
		- nd_pro à pt_pro
		- nd_gest à pt_gest
		- nd_user à pt_user
		- nd_detection à pt_detec
		- nd_statut à pt_statut
		- nd_etat à pt_etat
		- nd_dateins à pt_dateins
		- inversion pt_a_passa et pt_a_strat
		- nd_occup à pt_occup
	- pt_type_phy restreint aux valeurs APPUI, CHAMBRE, AUTRE. 
	- pt_nature ajouté pour prendre les types de chambres, poteaux, etc. 
- t_ebp	: 
	- ajout : bp_statut
		- nd_statut à pt_statut
		- nd_etat à pt_etat	
		- nd_occup à bp_occup
	- ajout : 
		- bp_entrees
		- bp_ca_nb
		- bp_nb_pas
		- bp_linecod
		- bp_oc_code
		- bp_sf_code
		- bp_racco
		- bp_typephy : avec liste des types fournis par E-Megalis. 
	- modif : bp_ref en integer
	- abandon : bp_dateins
	- abandon : bp_voie (dispo sur le noeud)
- t_cassette : 
	- modif : cs_rf_id renommé et type modifié
- t_adresse : 
	- Mise en correspondance des attributs avec les principaux attributs de la BAN. 
	- Prise en compte de relation avec la base MAJIC. 
	- ajout CHECK : CHECK (ad_ban_id LIKE 'ADRNIVX_________________')
	- ad_type : correction foreign keys
	- ad_hexacl -> ad_hexacle
	- Mise en correspondance IPE
		- ad_ietat
		- ad_idatsgn
		- ad_iaccgst
		- ad_id_gest
		- ad_idatcab
	- Abandon ADR_AUTRE0x du Syane. 
	- Spatialisation de la table. 
- t_suf : 
	- ajout d'attributs pour relation avec IPE. 
	- ajout référence sf_pr_adr
	- st_code -> sf_st_code
	- reorg sf_nbprise
	- renom sf_nbestim
	- sf_src_geo : abandon
	- sf_qlt_geo : abandon
	- sf_st_code : abandon
	- sf_tbati : abandon
	- sf_nd_code : ajout
- t_love : 
	- remplacement lo_ par lv_
- t_ropt ! 
	- remplacement ro_ par rt_
	- rf_fo_id remplacé par rf_fo_code
- t_position : 
	- remplacement po_ par ps_
	- type ps_amont et ps_aval passé en varchar pour code et non ID. 
- t_sitetech : 
	- ajout st_user depuis nd_user
	- st_stat -> st_statut
	- abandon st_cp et st_ville
	- st_type renommé st_typestr
	- ajout foreign key st_typestr	
	- ajout st_typefon
	- st_nbpr renommé st_nblines
- t_ltech : 
	- lt_stat -> lt_statut
	- relation base local base MAJIC (à étudier)
	- nd_occup à se_occup
- t_baie : 
	- ba_stat -> ba_statut
- t_position : 
	- modification ordre des attributs
- t_siteemission : 
	- se_nd_code
	- se_anfr
	- nd_pro à se_pro
	- nd_gest à se_gest
	- nd_user à se_user
	- nd_statut à se_statut
	- nd_etat à se_etat
	- nd_dateins à se_dateins
	- se_dt_ms
	- nd_occup à se_occup
- t_organisme : 
	- or_type : ajout de la référence aux codes juridiques INSEE dans la définition. 
	- or_activ : ajout de la référence aux codes NAF INSEE dans la définition. 
	- ajout d'attributs pour saisir l'adresse + lien optionnel avec la table t_adresse. 
- t_zone : abandon
	- Remplacement par de multiples tables de zones. 
	- Abandon des zones fibrées (loi macron) en attendant plus d'informations. 
	- Abandon des zones d'aménagement (notion Orange), à laisser aux données demandées par Orange. 
- t_znro : 
	- Création de la table
- t_zsro : 
	- Création de la table
- t_zpbo : 
	- Création de la table
- t_zdep : 
	- Création de cette table pour les zones de déploiement. 
- t_zcoax : 
	- Création de cette table pour les zones de couverture cablées (cablo-opérateur). 
- t_document : 
	- renommage en t_objdoc : la table t_document était la table ged du Syane, destinée à créer des relations entre objets et documents. 
	- création d'une nouvelle table t_document destinée à indexer les documents. 
	- ajout index unique multi-attributs : DROP INDEX IF EXISTS od_unique_idx; CREATE UNIQUE INDEX od_unique_idx ON t_love (od_code, od_tbltype, od_codeobj);
- t_objdoc : 
	- Renommage de cette table qui correspond à la table t_document dans les versions alpha précédentes, et GED côté Syane. 
	- od_budg abandonné
- t_empreinte : 
	- Création de cette table pour pouvoir stocker des polygones représentant l'empreinte (l'emprise géographique) de certains documents. 
- Listes : 
	- l_adress_type 
		-> l_adresse_type
		- ABANDON. 
	- l_adress_etat 
		-> l_adresse_etat
		- Utilisation valeurs Interop
	- l_artere_implantation_type : renommée l_implantation_type
	- l_zo_type
		- abandon (une table par type). 
	- l_propriete_type
		- OCCUPATION ajouté
	- l_site_type
		- renommé l_site_type_log
	- l_fibre_etat 
		- abandon au profit de l_etat. 
	- l_position_fonction
		- abandon EPISSURE-JCD / EPISSURE-HDS : spécifique Syane. 
	- l_marche
		- création de cette liste pour qualifier si c'est inclus, supplémentaire ou hors marché. 
	- l_suf_immeuble_type : renommé l_immeuble_type
	- l_suf_racco : création d'une liste avec la terminologie de raccordement des SUF selon l'Arcep. 
	- l_ptech_type_phy : modif totale des codes et valeurs (A, C, Z). 
	- l_ptech_nature : récupération des types de chambres, de poteaux, etc. 
	- l_accessibilite_type : abandonnée
	- l_zone_densite : ajouté
	- l_sro_etat : ajouté
	- l_sro_emplacement : ajouté
	- l_geoloc_mode : ajouté
	- l_fx_type : renommée l_conduite_type
	- l_doc_tab : FX -> CD
	- l_artere_type renommée l_infra_type_log
	- l_fo_type : ajout
	- l_tranchee_implantation_type : renommée l_passage_type. 
	- l_statut : application des phases préconisées en mission 3 et issues de la loi MOP. 
	
v2_alpha3c
- MCD : ajout de la prise en compte de la contrainte unique dans la génération SQL
- Ajout d'indexes
- Réduction des "obligatoire" (NOT NULL). 
- t_cable :
	- ajout référence à t_reference
	- abandon : fabricant
	- abandon : cb_fo_util
	- reorg des attributs. 
	- correspondance Syane. 
- t_fourreau : 
	- renommage fx_dateins, fx_dateaig, fx_dateman
	- suppression fx_nb
- t_love : 
	- ajout d'un index unique cable/noeud : CREATE UNIQUE INDEX lo_cb_no_code_idx ON t_love (lo_cb_code, lo_no_code);
- t_masque : 
	- mq_pt_code remplacé par mq_no_code. 
	- ajout d'un index unique pour garantir l'unicité de définition d'alvéole. DROP INDEX mq_alveole_idx; CREATE UNIQUE INDEX mq_alveole_idx ON t_masque (mq_no_code, mq_face, mq_col, mq_ligne);
- t_noeud : 
	- Modification du préfixe no_ en nd_ pour éviter les confusions O et 0. 
	- Ajout relation récursive pour modéliser la hiérarchie FTTH : nd_coderat. Peut convenir à d'autres cas (hiérarchie des sites radio, ...). 
	- abandon d'attributs. 
- t_cassette : 
	- correction relation bp_code
- t_ptech :
	- Ajout d'attributs spécifiques aux poteaux.
- t_ebp : 
	- Ajout bp_pm_code pour identifier les PBO et le PM (SRO) de rattachement. 
- t_fibre : 
	- ajout de la référence à t_fo_color. 
- t_tranchee : 
	- conservation seulement de tr_mut_org pour la gestion de la mutualisation/co-cons (cf. Oise). 
- t_zone : 
	- Ajout d'un attribut zo_code. 
	- Ajout d'un attribut et d'une relation récursive pour la gestion de parentalité des subdivisions. 
- Listes : 
	- l_zd_type : 
		- renommé l_zo_type
		- ajout ZF pour zone fibrée comme défini par amendement de la loi Macron. 
	- l_ptech_type : corrections/modifications/ajouts
	- l_fx_nature fusionnée avec l_fx_type
	- l_cassette_type : modif codes
	- l_qualite_info : creation
	- l_position_fonction : modif codes
	- l_technologie_type : reprises (oise)
	- l_technologie_cable_type : abandon au profit de l_technologie_type. 
	- l_doc_tab : corrections codes
	- l_bp_type : suppression des valeurs paliatives Grace v1. 	
	- l_color : renommage en l_fo_color. 
	- l_etat_type : abandon EXISTANT
	
v2_alpha3b
- Tables : 
	- Ajout de t_ devant les noms de tables qui ne sont pas des listes. 
- Listes :
	- Attributs : code, libelle, definition
	- l_propriete_type : ajouté + foreign keys
	- l_doc_tab : reprise des codes et VARCHAR(2)
- t_cable : 
	- suppression cb_tu_code (sous-tubage)
- t_love : 
	- Ajout des foreign keys


09/04/2015
v2_alpha3a
- Passage noms de tables et attributs en minuscules. 
- fourreau : 
	- ajout de fx_fx_code pour remplacer la table sous-tubage par une relation récursive. 
- sous-tubage : suppresion / fusion avec la table fourreau
- reference : ajout de la table reference du Syane. 
- renommage zonedesserte en zone. 
- Ajout d'attributs xx_r1_code, xx_r2_code, xx_r3_code, xx_r4_code sur tranchee, artere, fourreau, cable, noeud, zone. 
- Version non publiée. 


07/04/2015
v2_alpha2c (première version permettant de générer une base de données)
- Version augmentée de tables du Syane qui n'avaient pas été retenues (LOVE, MASQUE, ROPT). 
- Version diminuée des tables "RADIO", remise de la table SITEEMISSION grace v1. 
- Uniformisation des noms de tables. 
- Uniformisation des noms d'attributs (-10 caractères et préfixe "XX_" de tous les champs)
- Uniformisation des métadonnées de "cycle de vie" : date création, date mise à jour, source mise à jour, date abandon, cause abandon. 
- Attributs "CodeExterne" et "étiquette" généralisés pour tenir compte des infrastructures tierces. 
- Uniformisation des types de données pour la partie physique. 
- Uniformisation de la structure des tables d'énumérations et listes avec mise en conformité aux directives Covadis (Codes, pas d'entiers, etc.). 
- Abandon de certains attributs (feuille Att_abd du fichier de production du MCD). 
- TRANCHEE :
	- Remaniements
- PTECH
	- PT_ROTATIO
- EBP :
	- BP_ENTREES
- MASQUE : 
	- Pour test : Ajout code câble dans la table masque. 


v2_alpha2b
- Version dédiée à l'uniformisation avec les directives Covadis.  
- Version non publiée. 


v2_alpha2a
- Version un peu modifiée, dédiée à l'uniformisation avec les directives Covadis.  
- Version non publiée en dehors de la COVADIS (sans implications). 


04/02/2015
v2_alpha1e (modèle préalable consultation février 2015)
- Association du Geostandard ANT v1 avec quelques adaptations + partiellement Référentiel technique Syane
- Version "quick and dirty" destinée à servir de base de travail lors de la consultation de février 2015. 
